"use strict";function _objectSpread(r){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{},o=Object.keys(t);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(t).filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),o.forEach(function(e){_defineProperty(r,e,t[e])})}return r}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var server,port,debug=require("debug")("okikio:server"),cookieParser=require("cookie-parser"),template=require("lodash.template"),compress=require("compression"),express=require("express"),logger=require("morgan"),helmet=require("helmet"),http=require("http"),path=require("path"),fs=require("fs"),app=express(),config=require("./src/config"),jsdom=require("jsdom"),JSDOM=jsdom.JSDOM,render=function(){var o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"index",n=1<arguments.length?arguments[1]:void 0;return function(e,r,t){r.render(o,{barba:e.header("x-barba"),data:n})}},normalizePort=function(e){var r=parseInt(e,10);return isNaN(r)?e:0<=r&&r};port=normalizePort(process.env.PORT||"3000"),app.use(helmet()),app.use(compress()),app.use(express.static(path.join(__dirname,"public"),{maxAge:"2592000"})),app.engine("html",function(e,r,o){var n,p,a=r.barba,i=r.data;fs.readFile(e,function(e,r){if(e)return o(e);var t;(n=r.toString(),p=new JSDOM(n).window.document,i)&&(n=template(p.querySelector("[render]").outerHTML,{interpolate:/\%\=(.+?)\%/g})(i),t=new JSDOM(n).window.document.documentElement,p.querySelector("[render]").replaceWith(t),n=p.documentElement.outerHTML);return a&&(p=p.querySelector('[data-barba="container"]'),n=p.outerHTML),o(null,n)})}),app.set("views",path.join(__dirname,"./public")),app.set("view engine","html"),app.set("view cache",!0),app.use(logger("dev")),app.use(express.json()),app.use(express.urlencoded({extended:!1})),app.use(cookieParser()),app.get("/",render()),app.get("/about",render("about")),app.get("/contact",render("contact")),app.get("/project",render("project")),app.get("/project-list",render("project-list")),config.projects.forEach(function(e,r){var t=config.projects.length,o=r-1<0?t-1:r-1,n=t-1<r+1?0:r+1;app.get("/project/".concat(r),render("project",_objectSpread({nextNum:n,prevNum:o,next:config.projects[n],prev:config.projects[o]},e)))}),app.set("port",port),(server=http.createServer(app)).listen(port),server.on("error",function(e){if("listen"!==e.syscall)throw e;var r="string"==typeof port?"Pipe "+port:"Port "+port;switch(e.code){case"EACCES":console.error(r+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(r+" is already in use"),process.exit(1);break;default:throw e}}),server.on("listening",function(){var e=server.address(),r="string"==typeof e?"pipe "+e:"port "+e.port;debug("Listening on "+r)});